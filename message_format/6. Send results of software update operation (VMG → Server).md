# 6. Send success results (VMG → Server)

**Spec:** VMG → Server (prototype, success-only variant)

- Format: JSON (flat)
- Purpose: Report successful update operation results. Sent **only when ALL ECUs successfully updated**.

## Fields
- `msg_id` *(string, required)* — e.g., `VMG_MSG_0301`
- `proto_ver` *(string, required)* — e.g., `"1.0"`
- `type` *(string, required)* — fixed: `"UpdateSuccessResult"`
- `vehicle_id` *(string, required)* — e.g., `VEH_001`
- `gateway_id` *(string, required)* — e.g., `CCU_001`
- `ts` *(int64, required)* — send time (epoch ms UTC)
- `correlation_id` *(string, required)* — link to download start command msg_id

## Correlation ID Usage
- **Purpose**: Links this message to a previous message for request-response matching
- **Value**: Copy the `msg_id` from the triggering message
- **Usage**: Request↔Response matching, retry/duplicate detection, chunk sequence linking, long-term operation result attribution
- **Server Validation**: Verify `correlation_id` matches a valid `msg_id` sent by server, reject if expired (expires_at_ms/deadline_s)
- `operation` *(string, required)* — `"download" | "install" | "commit" | "rollback"`
- `duration_s` *(uint, optional)* — total operation duration
- `rebooted` *(bool, optional)* — whether vehicle rebooted
- `ecu_count` *(uint, required)* — number of ECUs successfully updated
- `verified_integrity` *(bool, required)* — all packages verified (hash + signature)

## ECU Update Architecture Explanation

### **All-or-Nothing Principle**
- **Dependency**: ECU 간 의존성으로 인해 부분 성공 불가능
- **Atomic Operation**: 모든 ECU에 완벽하게 라이팅 완료되어야 함
- **Boot Flag Swap**: 모든 ECU 준비 완료 후에만 부트플래그 스왑 (인스톨)
- **Success Condition**: 전체 업데이트가 성공했을 때만 이 메시지 전송

### **Why No Slot Information**
- **Internal Implementation**: Slot management is VMG's internal concern
- **Server Focus**: Server only needs to know if update succeeded
- **Synchronization**: If ECUs work normally, synchronization is complete
- **Simplified Interface**: Avoid exposing implementation details to server

## Notes
- This message is sent **only when ALL ECUs successfully updated**
- If any ECU fails, no message is sent (server detects failure via timeout)
- VMG automatically rolls back to previous state on failure
- `ecu_count` indicates total number of ECUs that were updated
- `verified_integrity` confirms all packages passed hash and signature verification

## Example — success (commit)
```json
{
  "msg_id": "VMG_MSG_0301",
  "proto_ver": "1.0",
  "type": "UpdateSuccessResult",
  "vehicle_id": "VEH_001",
  "gateway_id": "CCU_001",
  "ts": 1761351800000,
  "correlation_id": "SRV_MSG_0201",
  "operation": "commit",
  "duration_s": 125,
  "rebooted": true,
  "ecu_count": 8,
  "verified_integrity": true
}
```

