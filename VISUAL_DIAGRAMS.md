# Visual Connection Diagram

## System Overview
```
┌─────────────────────────────────────────────────────────────────┐
│                    TC375 Lite Kit System                        │
│                                                                 │
│  ┌──────────────────┐                ┌──────────────────┐      │
│  │                  │   QSPI2        │                  │      │
│  │   TC375 MCU      │◄──────────────►│  Flash 4 Click   │      │
│  │   (TriCore)      │                │  (S25FL512S)     │      │
│  │                  │                │                  │      │
│  └────────┬─────────┘                └──────────────────┘      │
│           │                                                     │
│           │ USB                                                 │
│           ▼                                                     │
│  ┌──────────────────┐                                          │
│  │   Debug Port     │                                          │
│  │   (DAP/JTAG)     │                                          │
│  └──────────────────┘                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## QSPI2 Interface Connection Detail
```
TC375 Lite Kit                           Flash 4 Click Module
┌──────────────────┐                    ┌──────────────────┐
│                  │                    │                  │
│  P15.8 (SCLK) ───┼───────────────────►│ SCK             │
│                  │   SPI Clock        │                  │
│                  │                    │                  │
│  P15.6 (MTSR) ───┼───────────────────►│ MOSI            │
│                  │   Data Out         │                  │
│                  │                    │                  │
│  P15.7 (MRST) ◄──┼────────────────────│ MISO            │
│                  │   Data In          │                  │
│                  │                    │                  │
│  P15.1 (SLSO8)───┼───────────────────►│ CS              │
│                  │   Chip Select      │                  │
│                  │                    │                  │
│  VCC (3.3V)   ───┼───────────────────►│ 3.3V            │
│                  │   Power            │                  │
│                  │                    │                  │
│  GND          ───┼───────────────────►│ GND             │
│                  │   Ground           │                  │
│                  │                    │                  │
└──────────────────┘                    └──────────────────┘
```

## MikroBUS Socket Pinout (Top View)
```
       ┌──────────────┐
       │   ○  ○  ○    │  ○ = Pin
       │              │
   1 ──┤ AN       PWM ├── 9
   2 ──┤ RST      INT ├── 10
   3 ──┤ CS        RX ├── 11
   4 ──┤ SCK       TX ├── 12
   5 ──┤ MISO     SCL ├── 13
   6 ──┤ MOSI     SDA ├── 14
   7 ──┤ 3.3V     5V  ├── 15
   8 ──┤ GND      GND ├── 16
       │              │
       └──────────────┘

Used Pins for Flash 4 Click:
  Pin 3  (CS)   → P15.1  (QSPI2_SLSO8)
  Pin 4  (SCK)  → P15.8  (QSPI2_SCLK)
  Pin 5  (MISO) → P15.7  (QSPI2_MRST)
  Pin 6  (MOSI) → P15.6  (QSPI2_MTSR)
  Pin 7  (3.3V) → VCC
  Pin 8  (GND)  → GND
```

## SPI Timing Diagram (Mode 0: CPOL=0, CPHA=0)
```
CS    ‾‾‾\______________________________________________/‾‾‾‾

SCLK  ____/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\_/‾\___

MOSI  ────<D7><D6><D5><D4><D3><D2><D1><D0>────────────────
           ^   ^   ^   ^   ^   ^   ^   ^
           │   │   │   │   │   │   │   └── Bit 0
           │   │   │   │   │   │   └────── Bit 1
           │   │   │   │   │   └────────── Bit 2
           │   │   │   │   └────────────── Bit 3
           │   │   │   └────────────────── Bit 4
           │   │   └────────────────────── Bit 5
           │   └────────────────────────── Bit 6
           └────────────────────────────── Bit 7 (MSB first)

MISO  ──────────────<D7><D6><D5><D4><D3><D2><D1><D0>──────
                     ^
                     └── Data sampled on rising edge

Legend:
  ‾  = High level
  _  = Low level
  /  = Rising edge
  \  = Falling edge
  <> = Data bit
```

## Flash Memory Organization
```
┌────────────────────────────────────────────────────┐
│              S25FL512S Flash Memory                │
│                  Total: 64 MB                      │
├────────────────────────────────────────────────────┤
│                                                    │
│  ┌──────────────────────────────────────────┐     │
│  │  Sector 0 (256 KB)                       │     │
│  │  Address: 0x00000000 - 0x0003FFFF        │     │
│  │  ┌────────────────────────────────┐      │     │
│  │  │ Page 0 (256 bytes)             │      │     │
│  │  ├────────────────────────────────┤      │     │
│  │  │ Page 1 (256 bytes)             │      │     │
│  │  ├────────────────────────────────┤      │     │
│  │  │ ...                            │      │     │
│  │  ├────────────────────────────────┤      │     │
│  │  │ Page 1023 (256 bytes)          │      │     │
│  │  └────────────────────────────────┘      │     │
│  └──────────────────────────────────────────┘     │
│                                                    │
│  ┌──────────────────────────────────────────┐     │
│  │  Sector 1 (256 KB)                       │     │
│  │  Address: 0x00040000 - 0x0007FFFF        │     │
│  └──────────────────────────────────────────┘     │
│                                                    │
│  ...                                               │
│                                                    │
│  ┌──────────────────────────────────────────┐     │
│  │  Sector 255 (256 KB)                     │     │
│  │  Address: 0x03FC0000 - 0x03FFFFFF        │     │
│  └──────────────────────────────────────────┘     │
│                                                    │
└────────────────────────────────────────────────────┘

Address Space: 0x00000000 to 0x03FFFFFF (32-bit addressing)
Total Sectors: 256
Pages per Sector: 1024
Bytes per Page: 256
```

## Software Architecture
```
┌─────────────────────────────────────────────────────────┐
│                   Application Layer                     │
│  ┌───────────────┐  ┌──────────────┐  ┌─────────────┐  │
│  │  Cpu0_Main.c  │  │ Flash4_      │  │   Config    │  │
│  │  (Test Code)  │  │ Examples.c   │  │   Storage   │  │
│  └───────┬───────┘  └──────┬───────┘  └──────┬──────┘  │
│          │                 │                  │         │
│          └─────────────────┼──────────────────┘         │
│                            │                            │
├────────────────────────────┼────────────────────────────┤
│                   Driver Layer                          │
│                  ┌─────────┴─────────┐                  │
│                  │  Flash4_Driver.c  │                  │
│                  │  Flash4_Driver.h  │                  │
│                  └─────────┬─────────┘                  │
│                            │                            │
├────────────────────────────┼────────────────────────────┤
│               Hardware Abstraction Layer                │
│                  ┌─────────┴─────────┐                  │
│                  │  iLLD (Infineon)  │                  │
│                  │  - IfxQspi        │                  │
│                  │  - IfxPort        │                  │
│                  │  - IfxStm         │                  │
│                  └─────────┬─────────┘                  │
│                            │                            │
├────────────────────────────┼────────────────────────────┤
│                   Hardware Layer                        │
│                  ┌─────────┴─────────┐                  │
│                  │   QSPI2 Module    │                  │
│                  │   (TC375 MCU)     │                  │
│                  └─────────┬─────────┘                  │
│                            │                            │
│                  ┌─────────┴─────────┐                  │
│                  │  Flash 4 Click    │                  │
│                  │  (MIKROE-3191)    │                  │
│                  └───────────────────┘                  │
└─────────────────────────────────────────────────────────┘
```

## Data Flow: Write Operation
```
Application                                        Flash Memory
    │                                                  │
    │ 1. Flash4_WriteCommand(WRITE_ENABLE)            │
    ├─────────────────────────────────────────────────►
    │                                                  │
    │ 2. Flash4_SectorErase4(address)                 │
    ├─────────────────────────────────────────────────►
    │                                    [Erasing...] │
    │                                                  │
    │ 3. Flash4_WaitReady(5000ms)                     │
    ├─────────────────────────────────────────────────►
    │◄─────────────────────────────────────────────────┤
    │                                       [Ready]    │
    │                                                  │
    │ 4. Flash4_WriteCommand(WRITE_ENABLE)            │
    ├─────────────────────────────────────────────────►
    │                                                  │
    │ 5. Flash4_PageProgram4(data, addr, size)        │
    ├─────────────────────────────────────────────────►
    │                                 [Programming...] │
    │                                                  │
    │ 6. Flash4_WaitReady(1000ms)                     │
    ├─────────────────────────────────────────────────►
    │◄─────────────────────────────────────────────────┤
    │                                       [Ready]    │
    │                                                  │
    │ Write Complete!                                  │
    │                                                  │
```

## Data Flow: Read Operation
```
Application                                        Flash Memory
    │                                                  │
    │ 1. Flash4_ReadFlash4(buffer, addr, size)        │
    ├─────────────────────────────────────────────────►
    │                                     [Reading...] │
    │◄─────────────────────────────────────────────────┤
    │                          [Data returned]         │
    │                                                  │
    │ Read Complete!                                   │
    │                                                  │
```

## LED Status Indication
```
TC375 Lite Kit
┌────────────────────────────┐
│                            │
│    ┌────┐                  │
│    │    │  LED1            │
│    └────┘                  │
│      ↓                     │
│   Status:                  │
│   ● ON  = Test PASSED      │
│   ○ OFF = Test FAILED      │
│                            │
└────────────────────────────┘

Test Sequence:
1. Device ID Check
2. Sector Erase
3. Data Write
4. Data Read
5. Data Verify
   ↓
   Success → LED ON
   Failure → LED OFF
```

## Power Distribution
```
TC375 Lite Kit                    Flash 4 Click
┌──────────────┐                  ┌──────────────┐
│              │                  │              │
│  USB Power   │                  │              │
│     │        │                  │              │
│     ▼        │                  │              │
│  ┌────────┐  │                  │              │
│  │  3.3V  │──┼──────────────────┼─► VCC        │
│  │ Reg.   │  │    ~20mA         │              │
│  └────────┘  │                  │  ┌────────┐  │
│              │                  │  │ Flash  │  │
│  ┌────────┐  │                  │  │  Chip  │  │
│  │  GND   │──┼──────────────────┼─►│        │  │
│  └────────┘  │                  │  └────────┘  │
│              │                  │              │
└──────────────┘                  └──────────────┘

Voltage Levels:
  VCC:  3.3V ±5%
  Logic High: 2.31V min
  Logic Low:  0.99V max
```

## Interrupt Flow
```
                 QSPI2 Hardware
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
   TX Complete    RX Complete    Error
        │              │              │
        ▼              ▼              ▼
   ISR_TX_60      ISR_RX_61      ISR_ER_62
        │              │              │
        └──────────────┼──────────────┘
                       │
                       ▼
              IfxQspi_SpiMaster
                 Handler
                       │
                       ▼
              Application callback
```

## Complete System Block Diagram
```
┌─────────────────────────────────────────────────────────────────┐
│                         PC / Host                               │
│  ┌──────────────────────────────────────────────────────┐       │
│  │     AURIX Development Studio (ADS)                   │       │
│  │  - Build Project                                     │       │
│  │  - Debug                                             │       │
│  │  - Flash Programming                                 │       │
│  └──────────────────────────────────────────────────────┘       │
│                           │                                     │
│                           │ USB                                 │
└───────────────────────────┼─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TC375 Lite Kit                               │
│  ┌──────────────────────────────────────────────────────┐       │
│  │               TC375 Microcontroller                  │       │
│  │  ┌────────────────────────────────────────────┐      │       │
│  │  │  CPU0 (TriCore)                            │      │       │
│  │  │  - Main application                        │      │       │
│  │  │  - Flash4 driver                           │      │       │
│  │  └────────────────────────────────────────────┘      │       │
│  │                    │                                 │       │
│  │                    ▼                                 │       │
│  │  ┌────────────────────────────────────────────┐      │       │
│  │  │  QSPI2 Module                              │      │       │
│  │  │  - Master mode                             │      │       │
│  │  │  - 1 MHz clock                             │      │       │
│  │  │  - Interrupt-driven                        │      │       │
│  │  └────────────────────────────────────────────┘      │       │
│  │         │   │   │   │                               │       │
│  │       SCLK MOSI MISO CS                             │       │
│  └─────────┼───┼───┼───┼───────────────────────────────┘       │
│            │   │   │   │                                       │
│    ┌───────┴───┴───┴───┴────────┐                             │
│    │    MikroBUS Socket          │                             │
│    └───────┬───┬───┬───┬─────────┘                             │
│            │   │   │   │                                       │
│            │   │   │   │                                       │
│    ┌───────┴───┴───┴───┴─────────┐                             │
│    │    Flash 4 Click Module     │                             │
│    │  ┌────────────────────────┐ │                             │
│    │  │  S25FL512S Flash Chip  │ │                             │
│    │  │  - 64 MB capacity      │ │                             │
│    │  │  - 256 sectors         │ │                             │
│    │  │  - SPI interface       │ │                             │
│    │  └────────────────────────┘ │                             │
│    └─────────────────────────────┘                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

This diagram shows the complete connection and data flow for the QSPI external memory system.

